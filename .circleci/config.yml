version: 2
jobs:
  build:
    docker:
      - image: debian:stretch

    steps:
      - checkout

      - run:
          name: Install packages
          command: |
            apt-get update
            apt-get -y install wget g++ make git

      - run:
          name: Upgrade CMake
          command: |
            wget -q -O cmake-linux.sh https://github.com/Kitware/CMake/releases/download/v3.14.0/cmake-3.14.0-Linux-x86_64.sh
            sh cmake-linux.sh -- --skip-license --prefix=/usr/local
            rm cmake-linux.sh

      # Build and test
      - run: mkdir _build
      - run: /usr/local/bin/ctest -VV -DBUILDNAME="${CIRCLE_BRANCH}_${CIRCLE_BUILD_NUM}" -S .circleci/ctest_driver_script.cmake
